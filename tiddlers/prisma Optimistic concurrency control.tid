created: 20250712074352031
modified: 20250712074449041
tags: 
title: prisma Optimistic concurrency control
type: text/vnd.tiddlywiki


```js
const seats = await client.seat.updateMany({
  data: {
    claimedBy: userEmail,
    version: {
      increment: 1,
    },
  },
  where: {
    id: availableSeat.id,
    version: availableSeat.version, // This version field is the key; only claim seat if in-memory version matches database version, indicating that the field has not been updated
  },
})

if (seats.count === 0) {
  throw new Error(`That seat is already booked! Please try again.`)
}
```

https://www.prisma.io/docs/orm/prisma-client/queries/transactions#optimistic-concurrency-control